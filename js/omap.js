var t,a,e,s=25.0315785,n=121.4427123,i=[],o=!1,l=!1,r=!0,c=!0,d="",b=!0,p=!0,g=!0,u=!1;$(function(){var q=new Date,x=q.getMinutes();x=10*(parseInt((x+10)/10)-1)+5;q=(new Date(q.getFullYear(),q.getMonth()+1,q.getDate(),q.getHours(),x)).getTime();x=document.createElement("script");x.onload=function(){h(!1)};x.src="/js/pharmacy_auto.js?r="+q;document.head.appendChild(x)});
var f=function(q){q=q.coords;s=q.latitude;n=q.longitude;void 0!==a?a.setLatLng([s,n]):(void 0===t&&w(),(a=L.marker([s,n]).bindTooltip("\u6211",{direction:"top",permanent:!0}).openTooltip()).addTo(t));t.setView([s,n],16)},m=function(q){void 0===t&&w()},h=function(q){(!0===q&&gtag("event","click",{event_category:"\u5730\u5716\u5de5\u5177",event_label:"\u4f7f\u7528\u8005\u5b9a\u4f4d"}),navigator.geolocation)?navigator.geolocation.getCurrentPosition(f,m,{enableHighAccuracy:!0,timeout:5E3,maximumAge:0}):
void 0===t&&w()},v=function(){bShowWarningMessage?showWarningMessage():showTopMessage()},w=function(){(t=L.map("omap",{zoomControl:!1})).on("load",v);t.setView([s,n],16);L.tileLayer("https://wmts.nlsc.gov.tw/wmts/EMAP/default/GoogleMapsCompatible/{z}/{y}/{x}",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://maps.nlsc.gov.tw/">\u570b\u571f\u6e2c\u7e6a\u4e2d\u5fc3</a>',maxZoom:20,minZoom:9}).addTo(t);L.control.zoom({position:"bottomright"}).addTo(t);
y();e=L.markerClusterGroup({chunkedLoading:!0,disableClusteringAtZoom:16,elementsPlacementStrategy:"original-locations"});T(!1)},y=function(){L.control.custom({position:"bottomright",content:'<button id="back_btn" type="button" class="btn btn-default" title="\u56de\u5230\u6211\u7684\u4f4d\u7f6e">    <i class="fas fa-crosshairs"></i></button><button id="info_btn" type="button" class="btn btn-info" title="\u516c\u544a">    <i class="fas fa-info"></i></button><a target="_blank" id="buy_mask" href="https://emask.taiwan.gov.tw/" class="btn btn-default" title="\u9810\u8cfc\u53e3\u7f69" onclick="buy_mask();">    <i class="fas fa-shopping-cart"></i></a><button id="reload_btn" type="button" class="btn btn-primary" title="\u91cd\u65b0\u6574\u7406">    <i class="fas fa-sync"></i></button><button id="history_btn" type="button" class="btn btn-success" title="\u66f4\u65b0\u7d00\u9304">    <i class="fas fa-list-alt"></i></button><button id="twcdc_fb_btn" type="button" class="btn btn-warning" title="\u75be\u7ba1\u7f72">    <i class="fas fa-clinic-medical"></i></button>',
classes:"btn-group-vertical bt-group-sm",style:{margin:"10px",padding:"0px 0 0 0",cursor:"pointer"}}).addTo(t);$("#back_btn").click(function(q){h(!0)});$("#exclamation_btn").click(function(q){showWarningMessage()});$("#info_btn").click(function(q){showInfoMessage()});$("#reload_btn").click(function(q){showUpdateProcess()});$("#history_btn").click(function(q){showVersionHistory()});$("#twcdc_fb_btn").click(function(q){showTwcdcFB()})},k=function(q){$("#reload_btn").attr("disabled",!0);$("#reload_btn i").removeClass();
$("#reload_btn i").addClass("fas fa-sync fa-spin fa-fw");$("#mask_inventory_last_update").html('<span id="process_status" class="fa fa-spinner fa-spin"></span>');T(q)},_=function(q,x,z,B){q=(new Date).getHours();return!(13<=q&&"X"==x&&"X"==z)&&!(18<=q&&"X"==z)&&B},X=function(q){var x=q.tel,z=q.addr,B=i[q.id],C="<h3>"+q.name+"</h3>";(C+="\u96fb\u8a71\uff1a<a href='tel:+886"+x+"'><i class='fas fa-phone-alt'></i> "+x+"</a><br />",C+="\u5730\u5740\uff1a<a target='_blank' href='https://www.google.com/maps/dir/?api=1&destination="+
z+"'><i class='fas fa-map-marked-alt'></i> "+z+"</a><br />",C+="<br /><b>\u53e3\u7f69\u5269\u9918\u6578\u91cf</b> (<span class='question_btn link-style' title='\u8cc7\u8a0a\u6709\u8aa4\u55ce\uff1f'>\u8cc7\u8a0a\u6709\u8aa4\u55ce\uff1f</span>)<br />",void 0===B)?C+="\u7121\u8cc7\u6599<br />":(reportTime=B[3],reportTime="\u7121\u7d00\u9304",""!=B[2]&&(reportTime=B[2].substr(5).replace(/-/g,"/")+" ("+D(B[2])+")"),0==B[0]&&0==B[1]?C+="\u7121\u5eab\u5b58":C+="\u6210\u4eba <i class='fas fa-user'></i>\uff1a"+
B[0]+"\u3000\u5152\u7ae5 <i class='fas fa-baby'></i>\uff1a"+B[1],detailData="\u5927\u4eba\u6700\u5f8c\u589e\u52a0\u6642\u9593: "+B[4]+"<br />\u5c0f\u5b69\u6700\u5f8c\u589e\u52a0\u6642\u9593: "+B[6]+"<br />\u5927\u4eba\u6700\u5f8c\u6e1b\u5c11\u6642\u9593: "+B[5]+"<br />\u5c0f\u5b69\u6700\u5f8c\u6e1b\u5c11\u6642\u9593: "+B[7],C+="<br /><span class='moreBusinessInfo' title='"+detailData+"'>\u6700\u5f8c\u7570\u52d5\u6642\u9593\uff1a"+reportTime+"</span><br />",(0<Date.parse(B[3].replace(/-/g,"/"))-Date.parse(d.replace(/-/g,
"/"))||""==d)&&(d=B[3]));null!=q.business_week&&(x=q.business_week.split(""),C=C+"<br/><b>\u71df\u696d\u8cc7\u8a0a</b><span class='showBusinessWeek link-style'> (\u9ede\u6211\u986f\u793a\u6216\u96b1\u85cf)</span><br/><table id='businessWeek' style='display:none;' class='tg'><tr><th class='tg-lboi'></th><th class='tg-lboi'>\u4e00</th><th class='tg-lboi'>\u4e8c</th><th class='tg-lboi'>\u4e09</th><th class='tg-lboi'>\u56db</th><th class='tg-lboi'>\u4e94</th><th class='tg-lboi'>\u516d</th><th class='tg-lboi'>\u65e5</th></tr><tr><td class='tg-lboi'>\u4e0a</td><td class='tg-lboi'>"+
(x[0]+"</td><td class='tg-lboi'>"+x[1]+"</td><td class='tg-lboi'>"+x[2]+"</td><td class='tg-lboi'>"+x[3]+"</td><td class='tg-lboi'>"+x[4]+"</td><td class='tg-weekend'>"+x[5]+"</td><td class='tg-weekend'>"+x[6]+"</td></tr><tr><td class='tg-lboi'>\u4e0b</td><td class='tg-lboi'>"+x[7]+"</td><td class='tg-lboi'>"+x[8]+"</td><td class='tg-lboi'>"+x[9]+"</td><td class='tg-lboi'>"+x[10]+"</td><td class='tg-lboi'>"+x[11]+"</td><td class='tg-weekend'>"+x[12]+"</td><td class='tg-weekend'>"+x[13]+"</td></tr><tr><td class='tg-lboi'>\u665a</td><td class='tg-lboi'>"+
x[14]+"</td><td class='tg-lboi'>"+x[15]+"</td><td class='tg-lboi'>"+x[16]+"</td><td class='tg-lboi'>"+x[17]+"</td><td class='tg-lboi'>"+x[18]+"</td><td class='tg-weekend'>"+x[19]+"</td><td class='tg-weekend'>"+x[20]+"</td></tr></table>"));void 0!==q.memo&&(q=$.trim(q.memo),0<q.length&&(-1!=q.indexOf("\u53e3\u7f69")?C+="<br/><span class='highred'>\u5099\u8a3b\uff1a"+q+"</span>":C+="<br/>\u5099\u8a3b\uff1a"+q));return C},T=function(q){i=[];var x=new Date,z=x.getMinutes();z=10*(parseInt((z+10)/10)-1)+
5;x=(new Date(x.getFullYear(),x.getMonth()+1,x.getDate(),x.getHours(),z)).getTime();$.ajax({url:"data/maskdata_auto.csv",async:q,cache:!1,data:{r:x},dataType:"text",success:function(B){B=B.split("\n");for(var C in B)if({}.hasOwnProperty.call(B,C)){var E=B[C].split(",");""!=$.trim(E[0])&&(i[E[0]]=[E[1],E[2],E[3].replace(/"/g,""),E[4].replace(/"/g,""),E[5].replace(/"/g,""),E[6].replace(/"/g,""),E[7].replace(/"/g,""),E[8].replace(/"/g,"")])}M()},complete:function(B,C){$("#reload_btn i").removeClass();
$("#reload_btn i").addClass("fas fa-sync");$("#reload_btn").attr("disabled",!1)}})},M=function(){void 0!==e&&e.clearLayers();var q=new Date,x;for(x in q=q.getDay(),locations)if({}.hasOwnProperty.call(locations,x)){var z=!0,B=locations[x],C="",E=0,G=0;void 0!==i[B.id]?(C=i[B.id],E=parseInt(C[0]),G=parseInt(C[1]),o?2>=E&&z&&(z=!1):l&&2>=G&&z&&(z=!1),C=0<E+G?"<i class='fas fa-user'></i>"+E+"&nbsp;<i class='fas fa-baby'></i>"+G:"\u7121\u5eab\u5b58"):C="\u7121\u5eab\u5b58";if("\u7121\u5eab\u5b58"==C&&
!1===u&&z&&(z=!1),c&&void 0!==B.business_week){var H,I,J,A=B.business_week.split("");1==q&&z?(z=!("X"==A[0]&&"X"==A[7]&&"X"==A[14]),H=A[0],I=A[7],J=A[14]):2==q&&z?(z=!("X"==A[1]&&"X"==A[8]&&"X"==A[15]),H=A[1],I=A[8],J=A[15]):3==q&&z?(z=!("X"==A[2]&&"X"==A[9]&&"X"==A[16]),H=A[2],I=A[9],J=A[16]):4==q&&z?(z=!("X"==A[3]&&"X"==A[10]&&"X"==A[17]),H=A[3],I=A[10],J=A[17]):5==q&&z?(z=!("X"==A[4]&&"X"==A[11]&&"X"==A[18]),H=A[4],I=A[11],J=A[18]):6==q&&z?(z=!("X"==A[5]&&"X"==A[12]&&"X"==A[19]),H=A[5],I=A[12],
J=A[19]):0==q&&z&&(z=!("X"==A[6]&&"X"==A[13]&&"X"==A[20]),H=A[6],I=A[13],J=A[20]);z&&(z=_(H,I,J,z))}var F=E+G,K=400;A="";if(!1===o&&!1===l&&(K=800,F=E+G),!0===o&&!0===l?E>G?(K=200,F=G):(K=600,F=E):o?(K=200,F=E):l&&(K=200,F=G),F>=K/2?(A="inventory-hight",b||(z=!1)):F>=.2*K?(A="inventory-medium",p||(z=!1)):0<F?(A="inventory-low",g||(z=!1)):0==F&&(A="inventory-zero"),z)z="",void 0!==B.memo&&(F=$.trim(B.memo),0<F.length&&(-1==F.indexOf("\u53e3\u7f69")&&-1==F.indexOf("\u865f\u78bc")||(z="\u8cfc\u8cb7\u898f\u5247<span class='fas fa-angle-right'></span>"))),
E=E.toString().concat(G.toString()).length,"\u7121\u5eab\u5b58"==C&&""==z?52:"\u7121\u5eab\u5b58"==C&&""!=z?82:6>E&&""==z?68:6>E&&""!=z?82:6==E?84:7==E?92:8==E&&100,C=L.divIcon({iconSize:null,html:'<div class="map-label"><div class="map-label-content '+A+'">'+C+'<div class="map-label-content-more">'+z+'</div></div><div class="map-label-arrow"></div></div>'}),C=L.marker([B.lat,B.lng],{icon:C,title:B.name,alt:B.name}).bindPopup(X(B),{minWidth:210}).on("popupopen",function(O){$(".question_btn").click(function(N){showQuestionInfo()});
$(".moreBusinessInfo").click(function(){var N=$(this).find(".title");N.length?N.remove():$(this).append('<span class="title">'+$(this).attr("title")+"</span>")});$(".showBusinessWeek").click(function(N){$("#businessWeek").toggle(500)});gtag("event","click",{event_category:"\u8ca9\u552e\u64da\u9ede",event_label:O.popup._source.pid})}),C.pid=B.id+B.name,e.addLayer(C)}t.addLayer(e);$("#mask_inventory_last_update").text(d.substr(5).replace(/-/g,"/"))},D=function(q){q=new Date(q.replace(/-/g,"/"));var x=
(new Date).getTime()-q.getTime();q=Math.floor(x/864E5);var z=x%864E5;x=Math.floor(z/36E5);var B=z%36E5;z=Math.floor(B/6E4);B=(Math.round(B%6E4/1E3),"");return 0!=q?B='<span class="highred" >'+q+"\u5929\u524d</span>":0==q&&0!=x?B='<span class="highred" >'+x+"\u5c0f\u6642\u524d</span>":0==q&&0==x&&40<=z?B='<span class="highred" >'+z+"\u5206\u937e\u524d</span>":0==q&&0==x&&(B=z+"\u5206\u937e\u524d"),B};
