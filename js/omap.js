var t,a,markers,e,s=25.0315785,i=121.4427123,n=[],o=[],l=[],r=[],c=[],show_all_inventory=!1,show_adult_inventory=!1,show_child_inventory=!1,show_test_kit_inventory=!0,show_pcr_pos=!1,d=!0,dont_show_no_open=!0,show_inventory_zero=!1,b="";$(function(){(e=document.createElement("script")).src="/js/pharmacy_auto.js?r="+p();e.onload=function(){m();u(!1)};document.head.appendChild(e)});
var p=function(){var z=new Date,C=z.getMinutes();return currentMinutes_add=5-C%5,(new Date(z.getFullYear(),z.getMonth()+1,z.getDate(),z.getHours(),C+currentMinutes_add)).getTime()},u=function(z){(!0===z&&gtag("event","click",{event_category:"\u5730\u5716\u5de5\u5177",event_label:"\u4f7f\u7528\u8005\u5b9a\u4f4d"}),navigator.geolocation)&&navigator.geolocation.getCurrentPosition(f,g,{enableHighAccuracy:!0,timeout:5E3,maximumAge:0})},f=function(z){z=z.coords;s=z.latitude;i=z.longitude;void 0!==a?a.setLatLng([s,
i]):(a=L.marker([s,i])).addTo(t);t.setView([s,i],17);gtag("event","click",{event_category:"\u5730\u5716\u5de5\u5177",event_label:"\u4f7f\u7528\u8005\u5b9a\u4f4d\u6210\u529f"})},g=function(z){err_code=z.code;gtag("event","click",{event_category:"\u5730\u5716\u5de5\u5177",event_label:"\u4f7f\u7528\u8005\u5b9a\u4f4d\u5931\u6557".err_code})},m=function(){(t=L.map("omap",{zoomControl:!1})).on("load",v);L.tileLayer("https://wmts.nlsc.gov.tw/wmts/EMAP/default/GoogleMapsCompatible/{z}/{y}/{x}",{attribution:'&copy; <a href="https://maps.nlsc.gov.tw/">\u570b\u571f\u6e2c\u7e6a\u4e2d\u5fc3</a>',
maxZoom:19,minZoom:9}).addTo(t);L.control.zoom({position:"bottomright"}).addTo(t);h();markers=L.markerClusterGroup({chunkedLoading:!0,disableClusteringAtZoom:16,elementsPlacementStrategy:"original-locations"});t.setView(["25.041772038439372","121.45227755042832"],13);reloadStrongholdData(!1)},v=function(){bShowWarningMessage?showWarningMessage():showInfoMessage("auto")},h=function(){L.control.custom({position:"bottomright",content:'<button id="back_btn" type="button" class="btn btn-light" title="\u56de\u5230\u6211\u7684\u4f4d\u7f6e">    <i class="fa-solid fa-location-crosshairs"></i></button><button id="info_btn" type="button" class="btn btn-info" title="\u516c\u544a">    <i class="fa-solid fa-info"></i></button><button id="buy_mask_btn" type="button" class="btn btn-light" title="\u793e\u4ea4\u8ddd\u96e2APP">    <a target="_blank" id="buy_mask" href="https://www.cdc.gov.tw/Category/Page/R8bAd_yiVi22CIr73qM2yw" title="\u793e\u4ea4\u8ddd\u96e2APP" onclick="buy_mask();">        <i class="fa-solid fa-mobile-screen-button"></i>    </a></button><button id="reload_btn" type="button" class="btn btn-primary" title="\u91cd\u65b0\u6574\u7406">    <i class="fa-solid fa-arrows-rotate"></i></button><button id="history_btn" type="button" class="btn btn-success" title="\u66f4\u65b0\u7d00\u9304">    <i class="fa-solid fa-rectangle-list"></i></button><button id="twcdc_fb_btn" type="button" class="btn btn-warning" title="\u75be\u7ba1\u7f72">    <i class="fa-solid fa-square-virus"></i></button>',
classes:"btn-group-vertical bt-group-sm",style:{margin:"10px",padding:"0px 0 0 0",cursor:"pointer"}}).addTo(t);$("#back_btn").click(function(z){u(!0)});$("#exclamation_btn").click(function(z){showWarningMessage()});$("#info_btn").click(function(z){showInfoMessage("manual")});$("#reload_btn").click(function(z){showUpdateProcess()});$("#history_btn").click(function(z){showVersionHistory()});$("#twcdc_fb_btn").click(function(z){showTwcdcFB()})},reloadStrongholdData=function(z){$("#reload_btn").attr("disabled",
!0);$("#reload_btn i").removeClass();$("#reload_btn i").addClass("fa-solid fa-arrows-rotate fa-spin fa-fw");_();show_pcr_pos?loadPCR(z):($("#inventory_last_update").html('<span id="process_status" class="fa fa-spinner fa-spin"></span>'),1==z?w(z):(w(z),y(z)))},_=function(){(e=document.createElement("script")).src="/js/pharmacy_auto.js?r="+p();document.head.appendChild(e)},loadPCR=function(z){0==c.length?(c=[],$.ajax({url:"data/pcr_auto.csv",async:z,cache:!1,dataType:"text",success:function(C){C=C.split("\n");
for(var B in C)if({}.hasOwnProperty.call(C,B)){var q=C[B].split(",");""!=$.trim(q[0])&&(c[q[0]]="")}},complete:function(C,B){$("#reload_btn i").removeClass();$("#reload_btn i").addClass("fa-solid fa-arrows-rotate");$("#reload_btn").attr("disabled",!1);X()}})):($("#reload_btn i").removeClass(),$("#reload_btn i").addClass("fa-solid fa-arrows-rotate"),$("#reload_btn").attr("disabled",!1),X())},w=function(z){n=[];$.ajax({url:"data/maskdata_auto.csv",async:z,cache:!1,dataType:"text",success:function(C){C=
C.split("\n");for(var B in C)if({}.hasOwnProperty.call(C,B)){var q=C[B].split(",");""!=$.trim(q[0])&&(n[q[0]]=[q[1],q[2],q[3].replace(/"/g,""),q[4].replace(/"/g,"")],l.push(q[0]))}},complete:function(C,B){1==z?y(z):($("#reload_btn i").removeClass(),$("#reload_btn i").addClass("fa-solid fa-arrows-rotate"),$("#reload_btn").attr("disabled",!1))}})},y=function(z){o=[];$.ajax({url:"data/test_kits_auto.csv",async:z,cache:!1,dataType:"text",success:function(C){C=C.split("\n");for(var B in C)if({}.hasOwnProperty.call(C,
B)){var q=C[B].split(",");""!=$.trim(q[0])&&(o[q[0]]=[q[1],q[2],q[3].replace(/"/g,""),q[4].replace(/"/g,"")],r.push(q[0]))}},complete:function(C,B){$("#reload_btn i").removeClass();$("#reload_btn i").addClass("fa-solid fa-arrows-rotate");$("#reload_btn").attr("disabled",!1);createStrongholdData()}})},createStrongholdData=function(){void 0!==markers&&markers.clearLayers();var z=new Date,C;for(C in z=z.getDay(),locations)if({}.hasOwnProperty.call(locations,C)){var B=!0,q=!0,A=!0,E=locations[C],F="<i class='fa-solid fa-mask-face'></i>&nbsp;\u7121\u5eab\u5b58",
J="<i class='fa-solid fa-vial-virus'></i>&nbsp;\u7121\u5eab\u5b58",O=0,P=0,M=0,K=0,Q=K=0;if(void 0!==n[E.id]&&(show_adult_inventory||show_child_inventory||show_all_inventory)){if(maskInventoryInfo=n[E.id],O=parseInt(maskInventoryInfo[0]),P=parseInt(maskInventoryInfo[1]),show_adult_inventory&&0==show_inventory_zero?q&&0>=O&&(q=!1):show_child_inventory&&0==show_inventory_zero&&q&&0>=P&&(q=!1),q){var S=new Date(maskInventoryInfo[2].replace(/-/g,"/"));K=28800<(N=((new Date).getTime()-S.getTime())/1E3)?
4:14400<N?3:7200<N?2:1}0<O+P&&(F="<i class='fa-solid fa-user'></i>&nbsp;"+O+"&nbsp;<i class='fa-solid fa-child'></i>&nbsp;"+P)}else q=!1,F="";if(void 0!==o[E.id]&&(show_test_kit_inventory||show_all_inventory)){if(M=parseInt(o[E.id][1]),0==show_inventory_zero&&A&&0>=M&&(A=!1),A){var N;S=new Date(o[E.id][2].replace(/-/g,"/"));Q=28800<(N=((new Date).getTime()-S.getTime())/1E3)?4:14400<N?3:7200<N?2:1}78==M?J="<i class='fa-solid fa-vial-virus'></i>&nbsp;"+M+" (\u53ef\u80fd\u672a\u5230\u8ca8)":0<M&&(J=
"<i class='fa-solid fa-vial-virus'></i>&nbsp;"+M)}else A=!1,J="";if(B=(""!=F||""!=J)&&(q||A),dont_show_no_open&&void 0!==E.business_week&&B){var G,H,I;q=E.business_week.split("");1==z?(B=!("X"==q[0]&&"X"==q[7]&&"X"==q[14]),G=q[0],H=q[7],I=q[14]):2==z?(B=!("X"==q[1]&&"X"==q[8]&&"X"==q[15]),G=q[1],H=q[8],I=q[15]):3==z?(B=!("X"==q[2]&&"X"==q[9]&&"X"==q[16]),G=q[2],H=q[9],I=q[16]):4==z?(B=!("X"==q[3]&&"X"==q[10]&&"X"==q[17]),G=q[3],H=q[10],I=q[17]):5==z?(B=!("X"==q[4]&&"X"==q[11]&&"X"==q[18]),G=q[4],
H=q[11],I=q[18]):6==z?(B=!("X"==q[5]&&"X"==q[12]&&"X"==q[19]),G=q[5],H=q[12],I=q[19]):0==z&&(B=!("X"==q[6]&&"X"==q[13]&&"X"==q[20]),G=q[6],H=q[13],I=q[20]);B&&(B=x(G,H,I,B))}B&&(B="",void 0!==E.memo&&0<$.trim(E.memo).length&&(B="\u8cfc\u8cb7\u898f\u5247<span class='fa-solid fa-angle-right'></span>"),K=show_adult_inventory||show_child_inventory?K:show_test_kit_inventory?Q:K<Q?K:Q,0<F.length&&(J="&nbsp;"+J),F=L.divIcon({iconSize:null,html:'<div class="map-label"><div class="map-label-content time-Lv'+
K+'">'+F+J+'<div class="map-label-content-more">'+B+'</div></div><div class="map-label-arrow"></div></div>'}),F=L.marker([E.lat,E.lng],{icon:F,title:E.name,alt:E.name}).bindPopup(k(E),{minWidth:210}).on("popupopen",function(T){$(".question_btn").click(function(R){showQuestionInfo()});$(".moreBusinessInfo").click(function(){var R=$(this).find(".title");R.length?R.remove():$(this).append('<span class="title">'+$(this).attr("title")+"</span>")});$(".showBusinessWeek").click(function(R){$("#businessWeek").toggle(500)});
gtag("event","click",{event_category:"\u8ca9\u552e\u64da\u9ede",event_label:T.popup._source.pid})}),F.pid=E.id+E.name,markers.addLayer(F))}t.addLayer(markers);$("#inventory_last_update").text(b.substr(5).replace(/-/g,"/"))},k=function(z){var C=z.tel,B=z.addr,q=n[z.id],A=o[z.id],E="<div class=''><h3>"+z.name+"</h3>";(E+="\u96fb\u8a71\uff1a<a class='link-primary' href='tel:"+C+"'>"+C+"</a> <i class='fa-solid fa-square-phone-flip text-primary'></i><br />",E+="\u5730\u5740\uff1a<a target='_blank' class='link-primary' href='https://www.google.com/maps/dir/?api=1&destination="+
B+"'>"+B+"</a> <i class='fa-solid fa-map-location-dot text-primary'></i><br />",E+="<br /><b>\u53e3\u7f69\u5269\u9918\u6578\u91cf</b> (<span class='question_btn link-style' title='\u8cc7\u8a0a\u6709\u8aa4\u55ce\uff1f'>\u8cc7\u8a0a\u6709\u8aa4\u55ce\uff1f</span>)<br />",void 0===q)?E+="\u7121\u8cc7\u6599<br />":(reportTime="\u7121\u7d00\u9304",""!=q[2]&&(reportTime=q[2].substr(5).replace(/-/g,"/")+" ("+D(q[2])+")"),0==q[0]&&0==q[1]?E+="\u7121\u5eab\u5b58":E+="\u6210\u4eba <i class='fa-solid fa-user'></i>\uff1a"+
q[0]+"\u3000\u5152\u7ae5 <i class='fa-solid fa-child'></i>\uff1a"+q[1],detailData="\u7a0b\u5f0f\u6700\u5f8c\u6293\u53d6\u6642\u9593: "+q[3],E+="<br /><span class='moreBusinessInfo' title='"+detailData+"'>\u5546\u5bb6\u66f4\u65b0\u6642\u9593\uff1a"+reportTime+"</span><br />",C=Date.parse(q[3].replace(/-/g,"/")),B=Date.parse(b.replace(/-/g,"/")),(0<C-B||""==b)&&(b=q[3]));if(E+="<br /><b>\u5feb\u7be9\u5269\u9918\u6578\u91cf</b><br />",void 0===A?E+="\u7121\u8cc7\u6599<br />":(reportTime="\u7121\u7d00\u9304",
""!=A[2]&&(reportTime=A[2].substr(5).replace(/-/g,"/")+" ("+D(A[2])+")"),78==A[1]?E+="\u53ef\u80fd\u7121\u5eab\u5b58 (78\u4efd\u9032\u8ca8\u53ef\u80fd\u672a\u5230)":0==A[1]?E+="\u7121\u5eab\u5b58":E+=A[0]+" <i class='fa-solid fa-vial-virus'></i>\uff1a"+A[1],detailData="\u7a0b\u5f0f\u6700\u5f8c\u6293\u53d6\u6642\u9593: "+A[3],E+="<br /><span class='moreBusinessInfo' title='"+detailData+"'>\u5546\u5bb6\u66f4\u65b0\u6642\u9593\uff1a"+reportTime+"</span><br />",(0<Date.parse(A[3].replace(/-/g,"/"))-Date.parse(b.replace(/-/g,
"/"))||""==b)&&(b=A[3])),null!=z.business_week)-1!=z.name.indexOf("\u91ab\u9662")&&show_pcr_pos?E+="<br/><b>\u71df\u696d\u8cc7\u8a0a</b><br/><span class='text-danger'>\u91ab\u9662\u793e\u5340\u63a1\u6aa2\u6642\u9593\u8acb\u8a73\u95b1\u91ab\u9662\u5b98\u7db2\u67e5\u8a62</span>":(q=z.business_week.split(""),E=E+"<br/><b>\u71df\u696d\u8cc7\u8a0a</b> <span class='showBusinessWeek link-style'>(\u9ede\u6211\u986f\u793a\u6216\u96b1\u85cf)</span><br/><table id='businessWeek' style='display:none;' class='tg'><tr><th class='tg-lboi'></th><th class='tg-lboi'>\u4e00</th><th class='tg-lboi'>\u4e8c</th><th class='tg-lboi'>\u4e09</th><th class='tg-lboi'>\u56db</th><th class='tg-lboi'>\u4e94</th><th class='tg-lboi'>\u516d</th><th class='tg-lboi'>\u65e5</th></tr><tr><td class='tg-lboi'>\u4e0a</td><td class='tg-lboi'>"+
(q[0]+"</td><td class='tg-lboi'>"+q[1]+"</td><td class='tg-lboi'>"+q[2]+"</td><td class='tg-lboi'>"+q[3]+"</td><td class='tg-lboi'>"+q[4]+"</td><td class='tg-weekend'>"+q[5]+"</td><td class='tg-weekend'>"+q[6]+"</td></tr><tr><td class='tg-lboi'>\u4e0b</td><td class='tg-lboi'>"+q[7]+"</td><td class='tg-lboi'>"+q[8]+"</td><td class='tg-lboi'>"+q[9]+"</td><td class='tg-lboi'>"+q[10]+"</td><td class='tg-lboi'>"+q[11]+"</td><td class='tg-weekend'>"+q[12]+"</td><td class='tg-weekend'>"+q[13]+"</td></tr><tr><td class='tg-lboi'>\u665a</td><td class='tg-lboi'>"+
q[14]+"</td><td class='tg-lboi'>"+q[15]+"</td><td class='tg-lboi'>"+q[16]+"</td><td class='tg-lboi'>"+q[17]+"</td><td class='tg-lboi'>"+q[18]+"</td><td class='tg-weekend'>"+q[19]+"</td><td class='tg-weekend'>"+q[20]+"</td></tr></table>"));void 0!==z.memo&&(z=$.trim(z.memo),0<z.length&&(-1!=z.indexOf("\u53e3\u7f69")||-1!=z.indexOf("\u5feb\u7be9")||-1!=z.indexOf("\u865f\u78bc\u724c")||-1!=z.indexOf("\u5eab\u5b58")?E+="<br/><span class='highred'>\u5099\u8a3b\uff1a"+z+"</span>":E+="<br/>\u5099\u8a3b\uff1a"+
z));return E+"</div>"},X=function(){void 0!==markers&&markers.clearLayers();var z=new Date,C;for(C in z=z.getDay(),locations)if({}.hasOwnProperty.call(locations,C)){var B=locations[C],q=!0;if(q=null!=c[B.id],dont_show_no_open&&void 0!==B.business_week&&q&&-1==B.name.indexOf("\u91ab\u9662")){var A=B.business_week.split("");1==z?(q=!("X"==A[0]&&"X"==A[7]&&"X"==A[14]),A[0],A[7],A[14]):2==z?(q=!("X"==A[1]&&"X"==A[8]&&"X"==A[15]),A[1],A[8],A[15]):3==z?(q=!("X"==A[2]&&"X"==A[9]&&"X"==A[16]),A[2],A[9],A[16]):
4==z?(q=!("X"==A[3]&&"X"==A[10]&&"X"==A[17]),A[3],A[10],A[17]):5==z?(q=!("X"==A[4]&&"X"==A[11]&&"X"==A[18]),A[4],A[11],A[18]):6==z?(q=!("X"==A[5]&&"X"==A[12]&&"X"==A[19]),A[5],A[12],A[19]):0==z&&(q=!("X"==A[6]&&"X"==A[13]&&"X"==A[20]),A[6],A[13],A[20])}q&&(q="",void 0!==B.memo&&0<$.trim(B.memo).length&&(q="\u8a73\u7d30\u8cc7\u8a0a<span class='fa-solid fa-angle-right'></span>"),q=L.divIcon({iconSize:null,html:'<div class="map-label"><div class="map-label-content">'+B.name+'<div class="map-label-content-more">'+
q+'</div></div><div class="map-label-arrow"></div></div>'}),q=L.marker([B.lat,B.lng],{icon:q,title:B.name,alt:B.name}).bindPopup(k(B),{minWidth:210}).on("popupopen",function(E){$(".question_btn").click(function(F){showQuestionInfo()});$(".moreBusinessInfo").click(function(){var F=$(this).find(".title");F.length?F.remove():$(this).append('<span class="title">'+$(this).attr("title")+"</span>")});$(".showBusinessWeek").click(function(F){$("#businessWeek").toggle(500)});gtag("event","click",{event_category:"\u63a1\u6aa2\u64da\u9ede",
event_label:E.popup._source.pid})}),q.pid=B.id+B.name,markers.addLayer(q))}t.addLayer(markers)},x=function(z,C,B,q){z=(new Date).getHours();return!(13<=z&&"X"==C&&"X"==B)&&!(18<=z&&"X"==B)&&q},D=function(z){z=new Date(z.replace(/-/g,"/"));var C=(new Date).getTime()-z.getTime();z=Math.floor(C/864E5);var B=C%864E5;C=Math.floor(B/36E5);var q=B%36E5;B=Math.floor(q/6E4);q=(Math.round(q%6E4/1E3),"");return 0!=z?q='<span class="highred" >'+z+"\u5929\u524d</span>":0==z&&0!=C?q='<span class="highred" >'+C+
"\u5c0f\u6642\u524d</span>":0==z&&0==C&&40<=B?q='<span class="highred" >'+B+"\u5206\u937e\u524d</span>":0==z&&0==C&&(q=B+"\u5206\u937e\u524d"),q};