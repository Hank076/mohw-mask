var t,e,a,s,n=25.0315785,i=121.4427123,l=[],o=[],c="",r=!1,d=!1,p=!1,b=!0,f=!1,g=!1,u=!0,m=!1;
$(function(){$("#filter").click(function(H){$(".filter_ctl").attr("disabled",!0);v();I()});setInterval(function(){v();P(!0)},12E4);(s=document.createElement("script")).src="/js/pharmacy_auto.js?r="+h();s.onload=function(){M();y();_(!1)};document.head.appendChild(s);var z=document.createElement("script");z.src="/js/gov_pcr_auto.js?r="+h();document.head.appendChild(z);z=document.createElement("script");z.src="/js/gov_covid19_test_kit_auto.js?r="+h();document.head.appendChild(z)});
var h=function(){var z=new Date,H=z.getMinutes(),J=5-H%5;return(new Date(z.getFullYear(),z.getMonth()+1,z.getDate(),z.getHours(),H+J)).getTime()},v=function(){u=$("#dont_show_no_open").is(":checked");m=$("#inventory_zero").is(":checked");g=f=b=p=d=r=!1;var z=$("input[name='type']:checked").val();"0"==z?r=!0:"1"==z?d=!0:"2"==z?p=!0:"3"==z?(d=!0,p=!0):"4"==z?b=!0:"5"==z?f=!0:"6"==z&&(g=!0)},_=function(z){(!0===z&&gtag("event","click",{event_category:"\u5730\u5716\u5de5\u5177",event_label:"\u4f7f\u7528\u8005\u5b9a\u4f4d"}),
navigator.geolocation)&&navigator.geolocation.getCurrentPosition(w,k,{enableHighAccuracy:!0,timeout:5E3,maximumAge:0})},w=function(z){z=z.coords;n=z.latitude;i=z.longitude;void 0!==e?e.setLatLng([n,i]):(e=L.marker([n,i])).addTo(t);t.setView([n,i],17);gtag("event","click",{event_category:"\u5730\u5716\u5de5\u5177",event_label:"\u4f7f\u7528\u8005\u5b9a\u4f4d\u6210\u529f"})},k=function(z){gtag("event","click",{event_category:"\u5730\u5716\u5de5\u5177",event_label:"\u4f7f\u7528\u8005\u5b9a\u4f4d\u5931\u6557"+
z.code})},y=function(){(t=L.map("omap",{zoomControl:!1})).on("load",X);L.tileLayer("https://wmts.nlsc.gov.tw/wmts/EMAP/default/GoogleMapsCompatible/{z}/{y}/{x}",{attribution:'&copy; <a href="https://maps.nlsc.gov.tw/">\u570b\u571f\u6e2c\u7e6a\u4e2d\u5fc3</a>',maxZoom:19,minZoom:9}).addTo(t);L.control.zoom({position:"bottomright"}).addTo(t);C();a=L.markerClusterGroup({chunkedLoading:!0,disableClusteringAtZoom:16,elementsPlacementStrategy:"original-locations"});t.setView(["25.041772038439372","121.45227755042832"],
13);P(!1)},X=function(){bShowWarningMessage?(gtag("event","click",{event_category:"\u63d0\u9192\u5de5\u5177",event_label:"\u91cd\u8981\u8a0a\u606f"}),showWarningMessage()):showInfoMessage("auto")},C=function(){L.control.custom({position:"bottomright",content:'<button id="back_btn" type="button" class="btn btn-light" title="\u56de\u5230\u6211\u7684\u4f4d\u7f6e">    <i class="fa-solid fa-location-crosshairs"></i></button><button id="info_btn" type="button" class="btn btn-info" title="\u516c\u544a">    <i class="fa-solid fa-info"></i></button><button id="buy_mask_btn" type="button" class="btn btn-light" title="\u793e\u4ea4\u8ddd\u96e2APP">    <a target="_blank" id="buy_mask" href="https://www.cdc.gov.tw/Category/Page/R8bAd_yiVi22CIr73qM2yw" title="\u793e\u4ea4\u8ddd\u96e2APP" onclick="buy_mask();">        <i class="fa-solid fa-mobile-screen-button"></i>    </a></button><button id="reload_btn" type="button" class="btn btn-primary" title="\u91cd\u65b0\u6574\u7406">    <i class="fa-solid fa-arrows-rotate"></i></button><button id="history_btn" type="button" class="btn btn-success" title="\u66f4\u65b0\u7d00\u9304">    <i class="fa-solid fa-rectangle-list"></i></button><button id="twcdc_fb_btn" type="button" class="btn btn-warning" title="\u75be\u7ba1\u7f72">    <i class="fa-solid fa-square-virus"></i></button>',
classes:"btn-group-vertical bt-group-sm",style:{margin:"10px",padding:"0px 0 0 0",cursor:"pointer"}}).addTo(t);$("#back_btn").click(function(z){_(!0)});$("#exclamation_btn").click(function(z){showWarningMessage()});$("#info_btn").click(function(z){gtag("event","click",{event_category:"\u63d0\u9192\u5de5\u5177",event_label:"\u63d0\u9192\u8cc7\u8a0a"});showInfoMessage("manual")});$("#buy_mask").click(function(z){gtag("event","click",{event_category:"\u63d0\u9192\u5de5\u5177",event_label:"\u793e\u4ea4\u8ddd\u96e2APP"})});
$("#reload_btn").click(function(z){x()});$("#history_btn").click(function(z){gtag("event","click",{event_category:"\u63d0\u9192\u5de5\u5177",event_label:"\u7db2\u7ad9\u6b77\u7a0b"});showVersionHistory()});$("#twcdc_fb_btn").click(function(z){D()})},x=function(){var z=$.dialog({icon:"fa-solid fa-arrows-spin fa-spin",animation:"top",closeAnimation:"bottom",columnClass:"col-md-4 col-md-offset-4",type:"orange",title:"\u8cc7\u6599\u66f4\u65b0\u4e2d",content:"\u6b63\u5728\u6293\u53d6\u6700\u65b0\u5eab\u5b58\u8cc7\u8a0a...",
onOpen:function(){f||g?W(!1):A(!1);z.setIcon("fas fa-check");z.setType("green");z.close();gtag("event","click",{event_category:"\u5730\u5716\u5de5\u5177",event_label:"\u66f4\u65b0\u5730\u5716"})}})},D=function(){$.dialog({icon:"fa-solid fa-square-virus",animation:"top",closeAnimation:"bottom",columnClass:"col-md-4 col-md-offset-4",type:"orange",title:"\u75be\u75c5\u7ba1\u5236\u7f72 - \u7c89\u7d72\u5718",content:'<iframe src="https://www.facebook.com/plugins/page.php?href=https%3A%2F%2Fwww.facebook.com%2FTWCDC&tabs=timeline&width=340&height=500&small_header=true&adapt_container_width=true&hide_cover=true&show_facepile=false&appId=544411143087055" width="340" height="500" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true" allow="encrypted-media"></iframe>',
backgroundDismiss:!0,onOpen:function(){gtag("event","click",{event_category:"\u63d0\u9192\u5de5\u5177",event_label:"\u75be\u7ba1\u7f72\u7c89\u7d72\u5718"})}})},I=function(){var z=$.dialog({icon:"fa-solid fa-spinner fa-spin",animation:"top",closeAnimation:"bottom",columnClass:"col-md-4 col-md-offset-4",type:"orange",title:"\u8cc7\u6599\u904e\u6ffe\u4e2d",content:"\u6b63\u5728\u904e\u6ffe\u5eab\u5b58\u8cc7\u8a0a...",onOpen:function(){a.clearLayers();f||g?W():A();$(".filter_ctl").attr("disabled",!1);
z.setIcon("fas fa-check");z.setType("green");z.close();var H=$("input[name='type']:checked").val();var J=u?"\u6709\u71df\u696d, ":"\u4e0d\u8ad6\u71df\u696d, ";"0"==H?J+="\u6240\u6709":"1"==H?J+="\u50c5\u6210\u4eba":"2"==H?J+="\u50c5\u5152\u7ae5":"3"==H?J+="\u6210\u4eba\u8207\u5152\u7ae5":"4"==H?J+="\u5feb\u7be9\u8a66\u5291":"5"==H?J+="PCR\u63a1\u6aa2\u7ad9":"6"==H&&(J+="\u516c\u8cbb\u5feb\u7be9\u767c\u653e\u7ad9");gtag("event","click",{event_category:"\u641c\u5c0b\u5de5\u5177",event_label:J})}})},
P=function(z){$("#reload_btn").attr("disabled",!0);$("#reload_btn i").removeClass();$("#reload_btn i").addClass("fa-solid fa-arrows-rotate fa-spin fa-fw");T();b?($("#inventory_last_update").html('<span id="process_status" class="fa fa-spinner fa-spin"></span>'),O(z)):W()},T=function(){(s=document.createElement("script")).src="/js/pharmacy_auto.js?r="+h();document.head.appendChild(s)},M=function(z){l=[];$.ajax({url:"data/maskdata_auto.csv",async:z,cache:!1,dataType:"text",success:function(H){H=H.split("\n");
for(var J in H)if({}.hasOwnProperty.call(H,J)){var E=H[J].split(",");""!=$.trim(E[0])&&(l[E[0]]=[E[1],E[2],E[3].replace(/"/g,""),E[4].replace(/"/g,"")])}},complete:function(H,J){1==z&&O(z)}})},O=function(z){o=[];$.ajax({url:"data/test_kits_auto.csv",async:z,cache:!1,dataType:"text",success:function(H){H=H.split("\n");for(var J in H)if({}.hasOwnProperty.call(H,J)){var E=H[J].split(",");""!=$.trim(E[0])&&(o[E[0]]=[E[1],E[2],E[3].replace(/"/g,""),E[4].replace(/"/g,"")])}},complete:function(H,J){A()}})},
A=function(){void 0!==a&&a.clearLayers();var z=new Date;z=z.getDay();for(var H in locations)if({}.hasOwnProperty.call(locations,H)){var J=!0,E=!0,F=!0,G=locations[H],R="<i class='fa-solid fa-mask-face'></i>&nbsp;\u7121\u5eab\u5b58",S="<i class='fa-solid fa-vial-virus'></i>&nbsp;\u7121\u5eab\u5b58",K=0,V=0,N=0,Q=0,U=Q=0;if(void 0!==l[G.id]&&(d||p||r)){var Z=l[G.id];if(K=parseInt(Z[0]),V=parseInt(Z[1]),d&&0==m?E&&0>=K&&(E=!1):p&&0==m&&E&&0>=V&&(E=!1),E)Q=new Date(Z[2].replace(/-/g,"/")),Q=((new Date).getTime()-
Q.getTime())/1E3,Q=28800<Q?4:14400<Q?3:7200<Q?2:1;0<K+V&&(R="<i class='fa-solid fa-user'></i>&nbsp;"+K+"&nbsp;<i class='fa-solid fa-child'></i>&nbsp;"+V)}else E=!1,R="";if(void 0!==o[G.id]&&(b||r)){if(N=parseInt(o[G.id][1]),0==m&&F&&0>=N&&(F=!1),F)U=new Date(o[G.id][2].replace(/-/g,"/")),U=((new Date).getTime()-U.getTime())/1E3,U=28800<U?4:14400<U?3:7200<U?2:1;78==N?S="<i class='fa-solid fa-vial-virus'></i>&nbsp;"+N+" (\u53ef\u80fd\u672a\u5230\u8ca8)":0<N&&(S="<i class='fa-solid fa-vial-virus'></i>&nbsp;"+
N)}else F=!1,S="";if(J=(""!=R||""!=S)&&(E||F),u&&void 0!==G.business_week&&J)N=F=E=void 0,K=G.business_week.split(""),1==z?(J=!("X"==K[0]&&"X"==K[7]&&"X"==K[14]),E=K[0],F=K[7],N=K[14]):2==z?(J=!("X"==K[1]&&"X"==K[8]&&"X"==K[15]),E=K[1],F=K[8],N=K[15]):3==z?(J=!("X"==K[2]&&"X"==K[9]&&"X"==K[16]),E=K[2],F=K[9],N=K[16]):4==z?(J=!("X"==K[3]&&"X"==K[10]&&"X"==K[17]),E=K[3],F=K[10],N=K[17]):5==z?(J=!("X"==K[4]&&"X"==K[11]&&"X"==K[18]),E=K[4],F=K[11],N=K[18]):6==z?(J=!("X"==K[5]&&"X"==K[12]&&"X"==K[19]),
E=K[5],F=K[12],N=K[19]):0==z&&(J=!("X"==K[6]&&"X"==K[13]&&"X"==K[20]),E=K[6],F=K[13],N=K[20]),J&&(J=q(E,F,N,J));J&&(J="",void 0!==G.memo&&0<$.trim(G.memo).length&&(J="\u8cfc\u8cb7\u898f\u5247<span class='fa-solid fa-angle-right'></span>"),Q=d||p?Q:b?U:Q<U?Q:U,0<R.length&&(S="&nbsp;"+S),R=L.divIcon({iconSize:null,html:'<div class="map-label"><div class="map-label-content time-Lv'+Q+'">'+R+S+'<div class="map-label-content-more">'+J+'</div></div><div class="map-label-arrow"></div></div>'}),R=L.marker([G.lat,
G.lng],{icon:R,title:G.name,alt:G.name}).bindPopup(j(G),{minWidth:210}).on("popupopen",function(aa){$(".question_btn").click(function(Y){showQuestionInfo()});$(".moreBusinessInfo").click(function(){var Y=$(this).find(".title");Y.length?Y.remove():$(this).append('<span class="title">'+$(this).attr("title")+"</span>")});$(".showBusinessWeek").click(function(Y){$("#businessWeek").toggle(500)});gtag("event","click",{event_category:"\u8ca9\u552e\u64da\u9ede",event_label:aa.popup._source.pid})}),R.pid=
G.id+G.name,a.addLayer(R))}t.addLayer(a);$("#reload_btn i").removeClass();$("#reload_btn i").addClass("fa-solid fa-arrows-rotate");$("#reload_btn").attr("disabled",!1);$("#inventory_last_update").text(c.substr(5).replace(/-/g,"/"))},W=function(){void 0!==a&&a.clearLayers();var z,H=new Date;H=H.getDay();f?z=gov_pcr_locations:g&&(z=gov_covid19_test_kit_locations);for(var J in z)if({}.hasOwnProperty.call(z,J)){var E=z[J],F=!0;if(u&&void 0!==E.business_week&&F&&-1==E.name.indexOf("\u91ab\u9662")){var G=
E.business_week.split("");1==H?F=!("X"==G[0]&&"X"==G[7]&&"X"==G[14]):2==H?F=!("X"==G[1]&&"X"==G[8]&&"X"==G[15]):3==H?F=!("X"==G[2]&&"X"==G[9]&&"X"==G[16]):4==H?F=!("X"==G[3]&&"X"==G[10]&&"X"==G[17]):5==H?F=!("X"==G[4]&&"X"==G[11]&&"X"==G[18]):6==H?F=!("X"==G[5]&&"X"==G[12]&&"X"==G[19]):0==H&&(F=!("X"==G[6]&&"X"==G[13]&&"X"==G[20]))}F&&(F="",void 0!==E.memo&&0<$.trim(E.memo).length&&(F="\u8a73\u7d30\u8cc7\u8a0a<span class='fa-solid fa-angle-right'></span>"),F=L.divIcon({iconSize:null,html:'<div class="map-label"><div class="map-label-content">'+
E.name+'<div class="map-label-content-more">'+F+'</div></div><div class="map-label-arrow"></div></div>'}),F=L.marker([E.lat,E.lng],{icon:F,title:E.name,alt:E.name}).bindPopup(j(E),{minWidth:210}).on("popupopen",function(R){$(".question_btn").click(function(S){showQuestionInfo()});$(".moreBusinessInfo").click(function(){var S=$(this).find(".title");S.length?S.remove():$(this).append('<span class="title">'+$(this).attr("title")+"</span>")});$(".showBusinessWeek").click(function(S){$("#businessWeek").toggle(500)});
gtag("event","click",{event_category:"\u63a1\u6aa2\u64da\u9ede",event_label:R.popup._source.pid})}),F.pid=E.id+E.name,a.addLayer(F))}t.addLayer(a);$("#reload_btn i").removeClass();$("#reload_btn i").addClass("fa-solid fa-arrows-rotate");$("#reload_btn").attr("disabled",!1)},j=function(z){var H=z.tel,J=z.addr,E=l[z.id],F=o[z.id],G="<div class=''><h3>"+z.name+"</h3>";(G+="\u96fb\u8a71\uff1a<a class='link-primary' href='tel:"+H+"'>"+H+"</a> <i class='fa-solid fa-square-phone-flip text-primary'></i><br />",
G+="\u5730\u5740\uff1a<a target='_blank' class='link-primary' href='https://www.google.com/maps/dir/?api=1&destination="+J+"'>"+J+"</a> <i class='fa-solid fa-map-location-dot text-primary'></i><br />",G+="<br /><b>\u53e3\u7f69\u5269\u9918\u6578\u91cf</b> (<span class='question_btn link-style' title='\u8cc7\u8a0a\u6709\u8aa4\u55ce\uff1f'>\u8cc7\u8a0a\u6709\u8aa4\u55ce\uff1f</span>)<br />",void 0===E)?G+="\u7121\u8cc7\u6599<br />":(H="\u7121\u7d00\u9304",""!=E[2]&&(H=E[2].substr(5).replace(/-/g,"/")+
" ("+B(E[2])+")"),0==E[0]&&0==E[1]?G+="\u7121\u5eab\u5b58":G+="\u6210\u4eba <i class='fa-solid fa-user'></i>\uff1a"+E[0]+"\u3000\u5152\u7ae5 <i class='fa-solid fa-child'></i>\uff1a"+E[1],G+="<br /><span class='moreBusinessInfo' title='\u7a0b\u5f0f\u6700\u5f8c\u6293\u53d6\u6642\u9593: "+E[3]+"'>\u5546\u5bb6\u66f4\u65b0\u6642\u9593\uff1a"+H+"</span><br />",(0<Date.parse(E[3].replace(/-/g,"/"))-Date.parse(c.replace(/-/g,"/"))||""==c)&&(c=E[3]));(G+="<br /><b>\u5feb\u7be9\u5269\u9918\u6578\u91cf</b><br />",
void 0===F)?G+="\u7121\u8cc7\u6599<br />":(E="\u7121\u7d00\u9304",""!=F[2]&&(E=F[2].substr(5).replace(/-/g,"/")+" ("+B(F[2])+")"),78==F[1]?G+="\u53ef\u80fd\u7121\u5eab\u5b58 (78\u4efd\u9032\u8ca8\u53ef\u80fd\u672a\u5230)":0==F[1]?G+="\u7121\u5eab\u5b58":G+=F[0]+" <i class='fa-solid fa-vial-virus'></i>\uff1a"+F[1],G+="<br /><span class='moreBusinessInfo' title='\u7a0b\u5f0f\u6700\u5f8c\u6293\u53d6\u6642\u9593: "+F[3]+"'>\u5546\u5bb6\u66f4\u65b0\u6642\u9593\uff1a"+E+"</span><br />",(0<Date.parse(F[3].replace(/-/g,
"/"))-Date.parse(c.replace(/-/g,"/"))||""==c)&&(c=F[3]));null!=z.business_week&&(-1!=z.name.indexOf("\u91ab\u9662")&&f?G+="<br/><b>\u71df\u696d\u8cc7\u8a0a</b><br/><span class='text-danger'>\u91ab\u9662\u793e\u5340\u63a1\u6aa2\u6642\u9593\u8acb\u8a73\u95b1\u91ab\u9662\u5b98\u7db2\u67e5\u8a62</span>":(F=z.business_week.split(""),G=G+"<br/><b>\u71df\u696d\u8cc7\u8a0a</b> <span class='showBusinessWeek link-style'>(\u9ede\u6211\u986f\u793a\u6216\u96b1\u85cf)</span><br/><table id='businessWeek' style='display:none;' class='tg'><tr><th class='tg-lboi'></th><th class='tg-lboi'>\u4e00</th><th class='tg-lboi'>\u4e8c</th><th class='tg-lboi'>\u4e09</th><th class='tg-lboi'>\u56db</th><th class='tg-lboi'>\u4e94</th><th class='tg-lboi'>\u516d</th><th class='tg-lboi'>\u65e5</th></tr><tr><td class='tg-lboi'>\u4e0a</td><td class='tg-lboi'>"+
(F[0]+"</td><td class='tg-lboi'>"+F[1]+"</td><td class='tg-lboi'>"+F[2]+"</td><td class='tg-lboi'>"+F[3]+"</td><td class='tg-lboi'>"+F[4]+"</td><td class='tg-weekend'>"+F[5]+"</td><td class='tg-weekend'>"+F[6]+"</td></tr><tr><td class='tg-lboi'>\u4e0b</td><td class='tg-lboi'>"+F[7]+"</td><td class='tg-lboi'>"+F[8]+"</td><td class='tg-lboi'>"+F[9]+"</td><td class='tg-lboi'>"+F[10]+"</td><td class='tg-lboi'>"+F[11]+"</td><td class='tg-weekend'>"+F[12]+"</td><td class='tg-weekend'>"+F[13]+"</td></tr><tr><td class='tg-lboi'>\u665a</td><td class='tg-lboi'>"+
F[14]+"</td><td class='tg-lboi'>"+F[15]+"</td><td class='tg-lboi'>"+F[16]+"</td><td class='tg-lboi'>"+F[17]+"</td><td class='tg-lboi'>"+F[18]+"</td><td class='tg-weekend'>"+F[19]+"</td><td class='tg-weekend'>"+F[20]+"</td></tr></table>")));void 0!==z.memo&&(z=$.trim(z.memo),0<z.length&&(-1!=z.indexOf("\u53e3\u7f69")||-1!=z.indexOf("\u5feb\u7be9")||-1!=z.indexOf("\u865f\u78bc\u724c")||-1!=z.indexOf("\u5eab\u5b58")?G+="<br/><span class='highred'>\u5099\u8a3b\uff1a"+z+"</span>":G+="<br/>\u5099\u8a3b\uff1a"+
z));return G+"</div>"},q=function(z,H,J,E){z=(new Date).getHours();return!(13<=z&&"X"==H&&"X"==J)&&!(18<=z&&"X"==J)&&E},B=function(z){z=new Date(z.replace(/-/g,"/"));var H=(new Date).getTime()-z.getTime();z=Math.floor(H/864E5);var J=H%864E5;H=Math.floor(J/36E5);J=Math.floor(J%36E5/6E4);var E="";return 0!=z?E='<span class="highred" >'+z+"\u5929\u524d</span>":0==z&&0!=H?E='<span class="highred" >'+H+"\u5c0f\u6642\u524d</span>":0==z&&0==H&&40<=J?E='<span class="highred" >'+J+"\u5206\u937e\u524d</span>":
0==z&&0==H&&(E=J+"\u5206\u937e\u524d"),E};