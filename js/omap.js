var t,a,markers,e,s=25.0315785,i=121.4427123,n=[],o=[],show_all_inventory=!1,show_adult_inventory=!1,show_child_inventory=!1,show_test_kit_inventory=!0,l=!0,dont_show_no_open=!0,show_inventory_zero=!1,r="";$(function(){(e=document.createElement("script")).src="/js/pharmacy_auto.js?r="+c();e.onload=function(){u();d(!1)};document.head.appendChild(e)});
var c=function(){var q=new Date,z=q.getMinutes();return currentMinutes_add=5-z%5,(new Date(q.getFullYear(),q.getMonth()+1,q.getDate(),q.getHours(),z+currentMinutes_add)).getTime()},d=function(q){(!0===q&&gtag("event","click",{event_category:"\u5730\u5716\u5de5\u5177",event_label:"\u4f7f\u7528\u8005\u5b9a\u4f4d"}),navigator.geolocation)&&navigator.geolocation.getCurrentPosition(b,p,{enableHighAccuracy:!0,timeout:5E3,maximumAge:0})},b=function(q){q=q.coords;s=q.latitude;i=q.longitude;void 0!==a?a.setLatLng([s,
i]):(a=L.marker([s,i])).addTo(t);t.setView([s,i],17);gtag("event","click",{event_category:"\u5730\u5716\u5de5\u5177",event_label:"\u4f7f\u7528\u8005\u5b9a\u4f4d\u6210\u529f"})},p=function(q){err_code=q.code;gtag("event","click",{event_category:"\u5730\u5716\u5de5\u5177",event_label:"\u4f7f\u7528\u8005\u5b9a\u4f4d\u5931\u6557".err_code})},u=function(){(t=L.map("omap",{zoomControl:!1})).on("load",f);L.tileLayer("https://wmts.nlsc.gov.tw/wmts/EMAP/default/GoogleMapsCompatible/{z}/{y}/{x}",{attribution:'&copy; <a href="https://maps.nlsc.gov.tw/">\u570b\u571f\u6e2c\u7e6a\u4e2d\u5fc3</a>',
maxZoom:19,minZoom:9}).addTo(t);L.control.zoom({position:"bottomright"}).addTo(t);g();markers=L.markerClusterGroup({chunkedLoading:!0,disableClusteringAtZoom:16,elementsPlacementStrategy:"original-locations"});t.setView(["25.041772038439372","121.45227755042832"],13);reloadStrongholdData(!1)},f=function(){bShowWarningMessage?showWarningMessage():showInfoMessage("auto")},g=function(){L.control.custom({position:"bottomright",content:'<button id="back_btn" type="button" class="btn btn-light" title="\u56de\u5230\u6211\u7684\u4f4d\u7f6e">    <i class="fa-solid fa-location-crosshairs"></i></button><button id="info_btn" type="button" class="btn btn-info" title="\u516c\u544a">    <i class="fa-solid fa-info"></i></button><button id="buy_mask_btn" type="button" class="btn btn-light" title="\u793e\u4ea4\u8ddd\u96e2APP">    <a target="_blank" id="buy_mask" href="https://www.cdc.gov.tw/Category/Page/R8bAd_yiVi22CIr73qM2yw" title="\u793e\u4ea4\u8ddd\u96e2APP" onclick="buy_mask();">        <i class="fa-solid fa-mobile-screen-button"></i>    </a></button><button id="reload_btn" type="button" class="btn btn-primary" title="\u91cd\u65b0\u6574\u7406">    <i class="fa-solid fa-arrows-rotate"></i></button><button id="history_btn" type="button" class="btn btn-success" title="\u66f4\u65b0\u7d00\u9304">    <i class="fa-solid fa-rectangle-list"></i></button><button id="twcdc_fb_btn" type="button" class="btn btn-warning" title="\u75be\u7ba1\u7f72">    <i class="fa-solid fa-square-virus"></i></button>',
classes:"btn-group-vertical bt-group-sm",style:{margin:"10px",padding:"0px 0 0 0",cursor:"pointer"}}).addTo(t);$("#back_btn").click(function(q){d(!0)});$("#exclamation_btn").click(function(q){showWarningMessage()});$("#info_btn").click(function(q){showInfoMessage("manual")});$("#reload_btn").click(function(q){showUpdateProcess()});$("#history_btn").click(function(q){showVersionHistory()});$("#twcdc_fb_btn").click(function(q){showTwcdcFB()})},reloadStrongholdData=function(q){$("#reload_btn").attr("disabled",
!0);$("#reload_btn i").removeClass();$("#reload_btn i").addClass("fa-solid fa-arrows-rotate fa-spin fa-fw");$("#inventory_last_update").html('<span id="process_status" class="fa fa-spinner fa-spin"></span>');m();1==q?v(q):(v(q),h(q))},m=function(){(e=document.createElement("script")).src="/js/pharmacy_auto.js?r="+c();document.head.appendChild(e)},v=function(q){n=[];$.ajax({url:"data/maskdata_auto.csv",async:q,cache:!1,dataType:"text",success:function(z){z=z.split("\n");for(var x in z)if({}.hasOwnProperty.call(z,
x)){var k=z[x].split(",");""!=$.trim(k[0])&&(n[k[0]]=[k[1],k[2],k[3].replace(/"/g,""),k[4].replace(/"/g,"")])}},complete:function(z,x){$("#reload_btn i").removeClass();$("#reload_btn i").addClass("fa-solid fa-arrows-rotate");$("#reload_btn").attr("disabled",!1);1==q&&h(q)}})},h=function(q){o=[];$.ajax({url:"data/test_kits_auto.csv",async:q,cache:!1,dataType:"text",success:function(z){z=z.split("\n");for(var x in z)if({}.hasOwnProperty.call(z,x)){var k=z[x].split(",");""!=$.trim(k[0])&&(o[k[0]]=[k[1],
k[2],k[3].replace(/"/g,""),k[4].replace(/"/g,"")])}},complete:function(z,x){$("#reload_btn i").removeClass();$("#reload_btn i").addClass("fa-solid fa-arrows-rotate");$("#reload_btn").attr("disabled",!1);createStrongholdData()}})},createStrongholdData=function(){void 0!==markers&&markers.clearLayers();var q=new Date,z;for(z in q=q.getDay(),locations)if({}.hasOwnProperty.call(locations,z)){var x=!0,k=!0,B=!0,A=locations[z],C="<i class='fa-solid fa-mask-face'></i>&nbsp;\u7121\u5eab\u5b58",G="<i class='fa-solid fa-vial-virus'></i>&nbsp;\u7121\u5eab\u5b58",
K=0,M=0,I=0,H=0,N=H=0;if(void 0!==n[A.id]&&(show_adult_inventory||show_child_inventory||show_all_inventory)){if(maskInventoryInfo=n[A.id],K=parseInt(maskInventoryInfo[0]),M=parseInt(maskInventoryInfo[1]),show_adult_inventory&&0==show_inventory_zero?k&&0>=K&&(k=!1):show_child_inventory&&0==show_inventory_zero&&k&&0>=M&&(k=!1),k){var P=new Date(maskInventoryInfo[2].replace(/-/g,"/"));H=28800<(J=((new Date).getTime()-P.getTime())/1E3)?4:14400<J?3:7200<J?2:1}0<K+M&&(C="<i class='fa-solid fa-user'></i>&nbsp;"+
K+"&nbsp;<i class='fa-solid fa-child'></i>&nbsp;"+M)}else k=!1,C="";if(void 0!==o[A.id]&&(show_test_kit_inventory||show_all_inventory)){if(I=parseInt(o[A.id][1]),0==show_inventory_zero&&B&&0>=I&&(B=!1),B){var J;P=new Date(o[A.id][2].replace(/-/g,"/"));N=28800<(J=((new Date).getTime()-P.getTime())/1E3)?4:14400<J?3:7200<J?2:1}78==I?G="<i class='fa-solid fa-vial-virus'></i>&nbsp;"+I+" (\u53ef\u80fd\u672a\u5230\u8ca8)":0<I&&(G="<i class='fa-solid fa-vial-virus'></i>&nbsp;"+I)}else B=!1,G="";if(x=(""!=
C||""!=G)&&(k||B),dont_show_no_open&&void 0!==A.business_week&&x){var D,E,F;k=A.business_week.split("");1==q?(x=!("X"==k[0]&&"X"==k[7]&&"X"==k[14]),D=k[0],E=k[7],F=k[14]):2==q?(x=!("X"==k[1]&&"X"==k[8]&&"X"==k[15]),D=k[1],E=k[8],F=k[15]):3==q?(x=!("X"==k[2]&&"X"==k[9]&&"X"==k[16]),D=k[2],E=k[9],F=k[16]):4==q?(x=!("X"==k[3]&&"X"==k[10]&&"X"==k[17]),D=k[3],E=k[10],F=k[17]):5==q?(x=!("X"==k[4]&&"X"==k[11]&&"X"==k[18]),D=k[4],E=k[11],F=k[18]):6==q?(x=!("X"==k[5]&&"X"==k[12]&&"X"==k[19]),D=k[5],E=k[12],
F=k[19]):0==q&&(x=!("X"==k[6]&&"X"==k[13]&&"X"==k[20]),D=k[6],E=k[13],F=k[20]);x&&(x=_(D,E,F,x))}x&&(x="",void 0!==A.memo&&0<$.trim(A.memo).length&&(x="\u8cfc\u8cb7\u898f\u5247<span class='fa-solid fa-angle-right'></span>"),H=show_adult_inventory||show_child_inventory?H:show_test_kit_inventory?N:H<N?H:N,0<C.length&&(G="&nbsp;"+G),C=L.divIcon({iconSize:null,html:'<div class="map-label"><div class="map-label-content time-Lv'+H+'">'+C+G+'<div class="map-label-content-more">'+x+'</div></div><div class="map-label-arrow"></div></div>'}),
C=L.marker([A.lat,A.lng],{icon:C,title:A.name,alt:A.name}).bindPopup(w(A),{minWidth:210}).on("popupopen",function(Q){$(".question_btn").click(function(O){showQuestionInfo()});$(".moreBusinessInfo").click(function(){var O=$(this).find(".title");O.length?O.remove():$(this).append('<span class="title">'+$(this).attr("title")+"</span>")});$(".showBusinessWeek").click(function(O){$("#businessWeek").toggle(500)});gtag("event","click",{event_category:"\u8ca9\u552e\u64da\u9ede",event_label:Q.popup._source.pid})}),
C.pid=A.id+A.name,markers.addLayer(C))}t.addLayer(markers);$("#inventory_last_update").text(r.substr(5).replace(/-/g,"/"))},w=function(q){var z=q.tel,x=q.addr,k=n[q.id],B=o[q.id],A="<div class=''><h3>"+q.name+"</h3>";(A+="\u96fb\u8a71\uff1a<a class='link-primary' href='tel:"+z+"'>"+z+"</a> <i class='fa-solid fa-square-phone-flip text-primary'></i><br />",A+="\u5730\u5740\uff1a<a target='_blank' class='link-primary' href='https://www.google.com/maps/dir/?api=1&destination="+x+"'>"+x+"</a> <i class='fa-solid fa-map-location-dot text-primary'></i><br />",
A+="<br /><b>\u53e3\u7f69\u5269\u9918\u6578\u91cf</b> (<span class='question_btn link-style' title='\u8cc7\u8a0a\u6709\u8aa4\u55ce\uff1f'>\u8cc7\u8a0a\u6709\u8aa4\u55ce\uff1f</span>)<br />",void 0===k)?A+="\u7121\u8cc7\u6599<br />":(reportTime="\u7121\u7d00\u9304",""!=k[2]&&(reportTime=k[2].substr(5).replace(/-/g,"/")+" ("+y(k[2])+")"),0==k[0]&&0==k[1]?A+="\u7121\u5eab\u5b58":A+="\u6210\u4eba <i class='fa-solid fa-user'></i>\uff1a"+k[0]+"\u3000\u5152\u7ae5 <i class='fa-solid fa-child'></i>\uff1a"+
k[1],detailData="\u7a0b\u5f0f\u6700\u5f8c\u6293\u53d6\u6642\u9593: "+k[3],A+="<br /><span class='moreBusinessInfo' title='"+detailData+"'>\u5546\u5bb6\u66f4\u65b0\u6642\u9593\uff1a"+reportTime+"</span><br />",z=Date.parse(k[3].replace(/-/g,"/")),x=Date.parse(r.replace(/-/g,"/")),(0<z-x||""==r)&&(r=k[3]));if(A+="<br /><b>\u5feb\u7be9\u5269\u9918\u6578\u91cf</b><br />",void 0===B?A+="\u7121\u8cc7\u6599<br />":(reportTime="\u7121\u7d00\u9304",""!=B[2]&&(reportTime=B[2].substr(5).replace(/-/g,"/")+" ("+
y(B[2])+")"),78==B[1]?A+="\u53ef\u80fd\u7121\u5eab\u5b58 (78\u4efd\u9032\u8ca8\u53ef\u80fd\u672a\u5230)":0==B[1]?A+="\u7121\u5eab\u5b58":A+=B[0]+" <i class='fa-solid fa-vial-virus'></i>\uff1a"+B[1],detailData="\u7a0b\u5f0f\u6700\u5f8c\u6293\u53d6\u6642\u9593: "+B[3],A+="<br /><span class='moreBusinessInfo' title='"+detailData+"'>\u5546\u5bb6\u66f4\u65b0\u6642\u9593\uff1a"+reportTime+"</span><br />",(0<Date.parse(B[3].replace(/-/g,"/"))-Date.parse(r.replace(/-/g,"/"))||""==r)&&(r=B[3])),null!=q.business_week)k=
q.business_week.split(""),A=A+"<br/><b>\u71df\u696d\u8cc7\u8a0a</b> <span class='showBusinessWeek link-style'>(\u9ede\u6211\u986f\u793a\u6216\u96b1\u85cf)</span><br/><table id='businessWeek' style='display:none;' class='tg'><tr><th class='tg-lboi'></th><th class='tg-lboi'>\u4e00</th><th class='tg-lboi'>\u4e8c</th><th class='tg-lboi'>\u4e09</th><th class='tg-lboi'>\u56db</th><th class='tg-lboi'>\u4e94</th><th class='tg-lboi'>\u516d</th><th class='tg-lboi'>\u65e5</th></tr><tr><td class='tg-lboi'>\u4e0a</td><td class='tg-lboi'>"+
(k[0]+"</td><td class='tg-lboi'>"+k[1]+"</td><td class='tg-lboi'>"+k[2]+"</td><td class='tg-lboi'>"+k[3]+"</td><td class='tg-lboi'>"+k[4]+"</td><td class='tg-weekend'>"+k[5]+"</td><td class='tg-weekend'>"+k[6]+"</td></tr><tr><td class='tg-lboi'>\u4e0b</td><td class='tg-lboi'>"+k[7]+"</td><td class='tg-lboi'>"+k[8]+"</td><td class='tg-lboi'>"+k[9]+"</td><td class='tg-lboi'>"+k[10]+"</td><td class='tg-lboi'>"+k[11]+"</td><td class='tg-weekend'>"+k[12]+"</td><td class='tg-weekend'>"+k[13]+"</td></tr><tr><td class='tg-lboi'>\u665a</td><td class='tg-lboi'>"+
k[14]+"</td><td class='tg-lboi'>"+k[15]+"</td><td class='tg-lboi'>"+k[16]+"</td><td class='tg-lboi'>"+k[17]+"</td><td class='tg-lboi'>"+k[18]+"</td><td class='tg-weekend'>"+k[19]+"</td><td class='tg-weekend'>"+k[20]+"</td></tr></table>");void 0!==q.memo&&(q=$.trim(q.memo),0<q.length&&(-1!=q.indexOf("\u53e3\u7f69")||-1!=q.indexOf("\u5feb\u7be9")||-1!=q.indexOf("\u865f\u78bc\u724c")||-1!=q.indexOf("\u5eab\u5b58")?A+="<br/><span class='highred'>\u5099\u8a3b\uff1a"+q+"</span>":A+="<br/>\u5099\u8a3b\uff1a"+
q));return A+"</div>"},_=function(q,z,x,k){q=(new Date).getHours();return!(13<=q&&"X"==z&&"X"==x)&&!(18<=q&&"X"==x)&&k},y=function(q){q=new Date(q.replace(/-/g,"/"));var z=(new Date).getTime()-q.getTime();q=Math.floor(z/864E5);var x=z%864E5;z=Math.floor(x/36E5);var k=x%36E5;x=Math.floor(k/6E4);k=(Math.round(k%6E4/1E3),"");return 0!=q?k='<span class="highred" >'+q+"\u5929\u524d</span>":0==q&&0!=z?k='<span class="highred" >'+z+"\u5c0f\u6642\u524d</span>":0==q&&0==z&&40<=x?k='<span class="highred" >'+
x+"\u5206\u937e\u524d</span>":0==q&&0==z&&(k=x+"\u5206\u937e\u524d"),k};