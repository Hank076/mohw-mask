var t,a,markers,e=25.0315785,s=121.4427123,i=[],n=[],show_all_inventory=!1,show_adult_inventory=!1,show_child_inventory=!1,show_test_kit_inventory=!0,o=!0,dont_show_no_open=!0,show_inventory_zero=!1,l="";$(function(){var k=new Date,y=k.getMinutes();y=10*(parseInt((y+10)/10)-1)+5;k=(new Date(k.getFullYear(),k.getMonth()+1,k.getDate(),k.getHours(),y)).getTime();y=document.createElement("script");y.onload=function(){d(!1)};y.src="/js/pharmacy_auto.js?r="+k;document.head.appendChild(y)});
var r=function(k){k=k.coords;e=k.latitude;s=k.longitude;void 0!==a?a.setLatLng([e,s]):(void 0===t&&p(),(a=L.marker([e,s]).bindTooltip("\u6211",{direction:"top",permanent:!0}).openTooltip()).addTo(t));t.setView([e,s],17)},c=function(k){void 0===t&&p()},d=function(k){(!0===k&&gtag("event","click",{event_category:"\u5730\u5716\u5de5\u5177",event_label:"\u4f7f\u7528\u8005\u5b9a\u4f4d"}),navigator.geolocation)?navigator.geolocation.getCurrentPosition(r,c,{enableHighAccuracy:!0,timeout:5E3,maximumAge:0}):
void 0===t&&p()},b=function(){bShowWarningMessage?showWarningMessage():showTopMessage()},p=function(){(t=L.map("omap",{zoomControl:!1})).on("load",b);L.tileLayer("https://wmts.nlsc.gov.tw/wmts/EMAP/default/GoogleMapsCompatible/{z}/{y}/{x}",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://maps.nlsc.gov.tw/">\u570b\u571f\u6e2c\u7e6a\u4e2d\u5fc3</a>',maxZoom:19,minZoom:9}).addTo(t);L.control.zoom({position:"bottomright"}).addTo(t);
g();markers=L.markerClusterGroup({chunkedLoading:!0,disableClusteringAtZoom:16,elementsPlacementStrategy:"original-locations"});reloadStrongholdData(!1)},g=function(){L.control.custom({position:"bottomright",content:'<button id="back_btn" type="button" class="btn btn-light" title="\u56de\u5230\u6211\u7684\u4f4d\u7f6e">    <i class="fa-solid fa-location-crosshairs"></i></button><button id="info_btn" type="button" class="btn btn-info" title="\u516c\u544a">    <i class="fa-solid fa-info"></i></button><button id="buy_mask_btn" type="button" class="btn btn-light" title="\u793e\u4ea4\u8ddd\u96e2APP">    <a target="_blank" id="buy_mask" href="https://www.cdc.gov.tw/Category/Page/R8bAd_yiVi22CIr73qM2yw" title="\u793e\u4ea4\u8ddd\u96e2APP" onclick="buy_mask();">        <i class="fa-solid fa-mobile-screen-button"></i>    </a></button><button id="reload_btn" type="button" class="btn btn-primary" title="\u91cd\u65b0\u6574\u7406">    <i class="fa-solid fa-arrows-rotate"></i></button><button id="history_btn" type="button" class="btn btn-success" title="\u66f4\u65b0\u7d00\u9304">    <i class="fa-solid fa-rectangle-list"></i></button><button id="twcdc_fb_btn" type="button" class="btn btn-warning" title="\u75be\u7ba1\u7f72">    <i class="fa-solid fa-square-virus"></i></button>',
classes:"btn-group-vertical bt-group-sm",style:{margin:"10px",padding:"0px 0 0 0",cursor:"pointer"}}).addTo(t);$("#back_btn").click(function(k){d(!0)});$("#exclamation_btn").click(function(k){showWarningMessage()});$("#info_btn").click(function(k){showInfoMessage()});$("#reload_btn").click(function(k){showUpdateProcess()});$("#history_btn").click(function(k){showVersionHistory()});$("#twcdc_fb_btn").click(function(k){showTwcdcFB()})},reloadStrongholdData=function(k){$("#reload_btn").attr("disabled",
!0);$("#reload_btn i").removeClass();$("#reload_btn i").addClass("fa-solid fa-arrows-rotate fa-spin fa-fw");$("#inventory_last_update").html('<span id="process_status" class="fa fa-spinner fa-spin"></span>');1==k?f(k):(f(k),m(k))},u=function(k,y,w,q){k=(new Date).getHours();return!(13<=k&&"X"==y&&"X"==w)&&!(18<=k&&"X"==w)&&q},f=function(k){i=[];var y=new Date,w=y.getMinutes();w=10*(parseInt((w+10)/10)-1)+5;y=(new Date(y.getFullYear(),y.getMonth()+1,y.getDate(),y.getHours(),w)).getTime();$.ajax({url:"data/maskdata_auto.csv",
async:k,cache:!1,data:{r:y},dataType:"text",success:function(q){q=q.split("\n");for(var A in q)if({}.hasOwnProperty.call(q,A)){var x=q[A].split(",");""!=$.trim(x[0])&&(i[x[0]]=[x[1],x[2],x[3].replace(/"/g,""),x[4].replace(/"/g,"")])}},complete:function(q,A){$("#reload_btn i").removeClass();$("#reload_btn i").addClass("fa-solid fa-arrows-rotate");$("#reload_btn").attr("disabled",!1);1==k&&m(k)}})},m=function(k){n=[];var y=new Date,w=y.getMinutes();w=10*(parseInt((w+10)/10)-1)+5;y=(new Date(y.getFullYear(),
y.getMonth()+1,y.getDate(),y.getHours(),w)).getTime();$.ajax({url:"data/test_kits_auto.csv",async:k,cache:!1,data:{r:y},dataType:"text",success:function(q){q=q.split("\n");for(var A in q)if({}.hasOwnProperty.call(q,A)){var x=q[A].split(",");""!=$.trim(x[0])&&(n[x[0]]=[x[1],x[2],x[3].replace(/"/g,""),x[4].replace(/"/g,"")])}},complete:function(q,A){$("#reload_btn i").removeClass();$("#reload_btn i").addClass("fa-solid fa-arrows-rotate");$("#reload_btn").attr("disabled",!1);createStrongholdData()}})},
createStrongholdData=function(){void 0!==markers&&markers.clearLayers();var k=new Date,y;for(y in k=k.getDay(),locations)if({}.hasOwnProperty.call(locations,y)){var w=!0,q=locations[y],A="\u7121\u5eab\u5b58",x="\u7121\u5eab\u5b58",B=0,G=0,F=0;void 0!==i[q.id]&&(show_adult_inventory||show_child_inventory||show_all_inventory)?(mask_inventory_data=i[q.id],B=parseInt(mask_inventory_data[0]),G=parseInt(mask_inventory_data[1]),show_adult_inventory?0>=B&&w&&(w=!1):show_child_inventory&&0>=G&&w&&(w=!1),0<
B+G&&(A="<i class='fa-solid fa-user'></i>&nbsp;"+B+"&nbsp;<i class='fa-solid fa-child'></i>&nbsp;"+G)):A="";if(void 0!==n[q.id]&&(show_test_kit_inventory||show_all_inventory)?(F=parseInt(n[q.id][1]),show_test_kit_inventory&&0>=F&&w&&(w=!1),78==F?x="<i class='fa-solid fa-vial-virus'></i>&nbsp;"+F+"(\u53ef\u80fd\u672a\u5230\u8ca8)":0<F&&(x="<i class='fa-solid fa-vial-virus'></i>&nbsp;"+F)):x="","\u7121\u5eab\u5b58"==A||"\u7121\u5eab\u5b58"==x?!1===show_inventory_zero&&w&&(w=!1):""==A&&""==x&&(w=!1),
dont_show_no_open&&void 0!==q.business_week&&w){var C,D,E,z=q.business_week.split("");1==k&&w?(w=!("X"==z[0]&&"X"==z[7]&&"X"==z[14]),C=z[0],D=z[7],E=z[14]):2==k&&w?(w=!("X"==z[1]&&"X"==z[8]&&"X"==z[15]),C=z[1],D=z[8],E=z[15]):3==k&&w?(w=!("X"==z[2]&&"X"==z[9]&&"X"==z[16]),C=z[2],D=z[9],E=z[16]):4==k&&w?(w=!("X"==z[3]&&"X"==z[10]&&"X"==z[17]),C=z[3],D=z[10],E=z[17]):5==k&&w?(w=!("X"==z[4]&&"X"==z[11]&&"X"==z[18]),C=z[4],D=z[11],E=z[18]):6==k&&w?(w=!("X"==z[5]&&"X"==z[12]&&"X"==z[19]),C=z[5],D=z[12],
E=z[19]):0==k&&w&&(w=!("X"==z[6]&&"X"==z[13]&&"X"==z[20]),C=z[6],D=z[13],E=z[20]);w&&(w=u(C,D,E,w))}w&&(w="",void 0!==q.memo&&0<$.trim(q.memo).length&&(w="\u8cfc\u8cb7\u898f\u5247<span class='fa-solid fa-angle-right'></span>"),B=B.toString().concat(G.toString()).concat(F.toString()).length,"\u7121\u5eab\u5b58"!=A&&"\u7121\u5eab\u5b58"!=x||""!=w?"\u7121\u5eab\u5b58"!=A&&"\u7121\u5eab\u5b58"!=x||""==w?6>B&&""==w?68:6>B&&""!=w?82:6==B?84:7==B?92:8==B&&100:82:52,0<A.length&&(x="&nbsp;"+x),A=L.divIcon({iconSize:null,
html:'<div class="map-label"><div class="map-label-content">'+A+x+'<div class="map-label-content-more">'+w+'</div></div><div class="map-label-arrow"></div></div>'}),A=L.marker([q.lat,q.lng],{icon:A,title:q.name,alt:q.name}).bindPopup(h(q),{minWidth:210}).on("popupopen",function(I){$(".question_btn").click(function(H){showQuestionInfo()});$(".moreBusinessInfo").click(function(){var H=$(this).find(".title");H.length?H.remove():$(this).append('<span class="title">'+$(this).attr("title")+"</span>")});
$(".showBusinessWeek").click(function(H){$("#businessWeek").toggle(500)});gtag("event","click",{event_category:"\u8ca9\u552e\u64da\u9ede",event_label:I.popup._source.pid})}),A.pid=q.id+q.name,markers.addLayer(A))}t.addLayer(markers);$("#inventory_last_update").text(l.substr(5).replace(/-/g,"/"))},h=function(k){var y=k.tel,w=k.addr,q=i[k.id],A=n[k.id],x="<h3>"+k.name+"</h3>";(x+="\u96fb\u8a71\uff1a<a class='link-primary' href='tel:+886"+y+"'><i class='fa-solid fa-phone'></i> "+y+"</a><br />",x+="\u5730\u5740\uff1a<a target='_blank' class='link-primary' href='https://www.google.com/maps/dir/?api=1&destination="+
w+"'><i class='fa-solid fa-map-location-dot'></i> "+w+"</a><br />",x+="<br /><b>\u53e3\u7f69\u5269\u9918\u6578\u91cf</b> (<span class='question_btn link-style' title='\u8cc7\u8a0a\u6709\u8aa4\u55ce\uff1f'>\u8cc7\u8a0a\u6709\u8aa4\u55ce\uff1f</span>)<br />",void 0===q)?x+="\u7121\u8cc7\u6599<br />":(reportTime="\u7121\u7d00\u9304",""!=q[2]&&(reportTime=q[2].substr(5).replace(/-/g,"/")+" ("+v(q[2])+")"),0==q[0]&&0==q[1]?x+="\u7121\u5eab\u5b58":x+="\u6210\u4eba <i class='fa-solid fa-user'></i>\uff1a"+
q[0]+"\u3000\u5152\u7ae5 <i class='fa-solid fa-child'></i>\uff1a"+q[1],detailData="\u7a0b\u5f0f\u6700\u5f8c\u6293\u53d6\u6642\u9593: "+q[3],x+="<br /><span class='moreBusinessInfo' title='"+detailData+"'>\u5546\u5bb6\u4e0a\u50b3\u6642\u9593\uff1a"+reportTime+"</span><br />",y=Date.parse(q[3].replace(/-/g,"/")),w=Date.parse(l.replace(/-/g,"/")),(0<y-w||""==l)&&(l=q[3]));if(x+="<br /><b>\u5feb\u7be9\u5269\u9918\u6578\u91cf</b><br />",void 0===A?x+="\u7121\u8cc7\u6599<br />":(reportTime="\u7121\u7d00\u9304",
""!=A[2]&&(reportTime=A[2].substr(5).replace(/-/g,"/")+" ("+v(A[2])+")"),78==A[1]?x+="\u53ef\u80fd\u7121\u5eab\u5b58(78\u4efd\u9032\u8ca8\u53ef\u80fd\u672a\u5230)":0==A[1]?x+="\u7121\u5eab\u5b58":x+=A[0]+" <i class='fa-solid fa-vial-virus'></i>\uff1a"+A[1],detailData="\u7a0b\u5f0f\u6700\u5f8c\u6293\u53d6\u6642\u9593: "+A[3],x+="<br /><span class='moreBusinessInfo' title='"+detailData+"'>\u5546\u5bb6\u4e0a\u50b3\u6642\u9593\uff1a"+reportTime+"</span><br />",(0<Date.parse(A[3].replace(/-/g,"/"))-Date.parse(l.replace(/-/g,
"/"))||""==l)&&(l=A[3])),null!=k.business_week)q=k.business_week.split(""),x=x+"<br/><b>\u71df\u696d\u8cc7\u8a0a</b><span class='showBusinessWeek link-style'> (\u9ede\u6211\u986f\u793a\u6216\u96b1\u85cf)</span><br/><table id='businessWeek' style='display:none;' class='tg'><tr><th class='tg-lboi'></th><th class='tg-lboi'>\u4e00</th><th class='tg-lboi'>\u4e8c</th><th class='tg-lboi'>\u4e09</th><th class='tg-lboi'>\u56db</th><th class='tg-lboi'>\u4e94</th><th class='tg-lboi'>\u516d</th><th class='tg-lboi'>\u65e5</th></tr><tr><td class='tg-lboi'>\u4e0a</td><td class='tg-lboi'>"+
(q[0]+"</td><td class='tg-lboi'>"+q[1]+"</td><td class='tg-lboi'>"+q[2]+"</td><td class='tg-lboi'>"+q[3]+"</td><td class='tg-lboi'>"+q[4]+"</td><td class='tg-weekend'>"+q[5]+"</td><td class='tg-weekend'>"+q[6]+"</td></tr><tr><td class='tg-lboi'>\u4e0b</td><td class='tg-lboi'>"+q[7]+"</td><td class='tg-lboi'>"+q[8]+"</td><td class='tg-lboi'>"+q[9]+"</td><td class='tg-lboi'>"+q[10]+"</td><td class='tg-lboi'>"+q[11]+"</td><td class='tg-weekend'>"+q[12]+"</td><td class='tg-weekend'>"+q[13]+"</td></tr><tr><td class='tg-lboi'>\u665a</td><td class='tg-lboi'>"+
q[14]+"</td><td class='tg-lboi'>"+q[15]+"</td><td class='tg-lboi'>"+q[16]+"</td><td class='tg-lboi'>"+q[17]+"</td><td class='tg-lboi'>"+q[18]+"</td><td class='tg-weekend'>"+q[19]+"</td><td class='tg-weekend'>"+q[20]+"</td></tr></table>");void 0!==k.memo&&(k=$.trim(k.memo),0<k.length&&(-1!=k.indexOf("\u53e3\u7f69")||-1!=k.indexOf("\u5feb\u7be9")||-1!=k.indexOf("\u865f\u78bc\u724c")||-1!=k.indexOf("\u5eab\u5b58")?x+="<br/><span class='highred'>\u5099\u8a3b\uff1a"+k+"</span>":x+="<br/>\u5099\u8a3b\uff1a"+
k));return x},v=function(k){k=new Date(k.replace(/-/g,"/"));var y=(new Date).getTime()-k.getTime();k=Math.floor(y/864E5);var w=y%864E5;y=Math.floor(w/36E5);var q=w%36E5;w=Math.floor(q/6E4);q=(Math.round(q%6E4/1E3),"");return 0!=k?q='<span class="highred" >'+k+"\u5929\u524d</span>":0==k&&0!=y?q='<span class="highred" >'+y+"\u5c0f\u6642\u524d</span>":0==k&&0==y&&40<=w?q='<span class="highred" >'+w+"\u5206\u937e\u524d</span>":0==k&&0==y&&(q=w+"\u5206\u937e\u524d"),q};